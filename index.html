<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My Vocab ‚Äì Doc Chan Edition</title>

<style>
:root{
  --bg:#f4f5fb;
  --card:#ffffff;
  --blue:#0a84ff;
  --purple:#5e5ce6;
  --text:#111;
  --muted:#666;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
  padding:16px;
}
h1{margin:0 0 6px;font-size:28px}
.count{font-weight:600;margin-bottom:10px}

.top{
  display:flex;
  gap:10px;
  align-items:center;
  margin-bottom:14px;
}
.top input{
  flex:1;
  padding:12px;
  border-radius:14px;
  border:1px solid #ddd;
  font-size:16px;
}

.btn{
  border:none;
  color:#fff;
  font-weight:700;
  padding:12px 18px;
  border-radius:18px;
  font-size:16px;
  cursor:pointer;
}
.import{background:var(--blue)}
.export{background:var(--purple)}

.list{margin-top:10px}
.card{
  background:var(--card);
  border-radius:20px;
  padding:14px;
  margin-bottom:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.left{max-width:75%}
.word{font-size:20px;font-weight:800}
.ipa{color:var(--muted);margin:2px 0}
.meaning{margin-top:2px}

.actions{
  display:flex;
  gap:12px;
  font-size:26px;
}
.actions span{cursor:pointer}

.add-empty{
  margin-top:40px;
  text-align:center;
}
.add-empty button{
  background:var(--blue);
  color:#fff;
  border:none;
  padding:14px 22px;
  border-radius:20px;
  font-size:18px;
  font-weight:700;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  display:none;
  align-items:center;
  justify-content:center;
}
.box{
  background:#fff;
  width:90%;
  max-width:420px;
  border-radius:22px;
  padding:16px;
}
.box input,.box textarea{
  width:100%;
  padding:12px;
  margin-bottom:8px;
  border-radius:14px;
  border:1px solid #ddd;
  font-size:16px;
}
.play-row{
  display:flex;
  gap:10px;
  margin-bottom:10px;
}
.play-row button{
  flex:1;
  border:none;
  border-radius:14px;
  padding:12px;
  font-weight:700;
  cursor:pointer;
}
.play{background:var(--blue);color:#fff}
.slow{background:#34c759;color:#fff}

.modal-actions{
  display:flex;
  gap:10px;
}
.save{background:var(--blue);color:#fff}
.del{background:#ff3b30;color:#fff}
.cancel{background:#aaa;color:#fff}
</style>
</head>

<body>

<h1>üìò My Vocab ‚Äì Doc Chan Edition</h1>
<div class="count" id="count">Total vocabulary: 0 words</div>

<div class="top">
  <input id="search" placeholder="Search word..." oninput="render()">
  <label class="btn import">
    üì• Import
    <input type="file" hidden accept=".csv" onchange="importCSV(event)">
  </label>
  <button class="btn export" onclick="exportCSV()">üì§ Export</button>
</div>

<div class="list" id="list"></div>

<div class="add-empty" id="empty">
  <button onclick="openAdd()">‚ûï Add first word</button>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="box">
    <input id="mWord" placeholder="Word">
    <input id="mIPA" placeholder="Pronunciation (IPA)">
    <input id="mMeaning" placeholder="Meaning">
    <textarea id="mExample" placeholder="Example sentence"></textarea>

    <div class="play-row">
      <button class="play" onclick="speak(false)">üîä Word</button>
      <button class="slow" onclick="speak(true)">üê¢ Slow</button>
    </div>

    <div class="modal-actions">
      <button class="btn save" onclick="save()">Save</button>
      <button class="btn del" onclick="remove()">Delete</button>
      <button class="btn cancel" onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
let vocab = JSON.parse(localStorage.getItem("myvocab")||"[]");
let editIndex = null;

function saveLS(){
  localStorage.setItem("myvocab",JSON.stringify(vocab));
}

function render(){
  const q=document.getElementById("search").value.toLowerCase();
  const list=document.getElementById("list");
  list.innerHTML="";
  vocab.filter(v=>v.word.toLowerCase().includes(q)).forEach((v,i)=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <div class="left" onclick="openEdit(${i})">
        <div class="word">"${v.word}</div>
        <div class="ipa">/${v.ipa||""}/</div>
        <div class="meaning">${v.meaning}</div>
      </div>
      <div class="actions">
        <span onclick="playWord(event,'${v.word}',1)">üîä</span>
        <span onclick="playWord(event,'${v.word}',0.6)">üê¢</span>
        <span onclick="openEdit(${i})">‚úèÔ∏è</span>
      </div>
    `;
    list.appendChild(d);
  });
  document.getElementById("count").innerText=`Total vocabulary: ${vocab.length} words`;
  document.getElementById("empty").style.display=vocab.length?"none":"block";
}

function openAdd(){
  editIndex=null;
  mWord.value="";
  mIPA.value="";
  mMeaning.value="";
  mExample.value="";
  modal.style.display="flex";
}
function openEdit(i){
  editIndex=i;
  const v=vocab[i];
  mWord.value=v.word;
  mIPA.value=v.ipa||"";
  mMeaning.value=v.meaning;
  mExample.value=v.example||"";
  modal.style.display="flex";
}
function closeModal(){modal.style.display="none"}

function save(){
  const data={
    word:mWord.value.trim(),
    ipa:mIPA.value.trim(),
    meaning:mMeaning.value.trim(),
    example:mExample.value.trim()
  };
  if(!data.word||!data.meaning)return alert("Word & meaning required");
  if(editIndex===null)vocab.push(data);
  else vocab[editIndex]=data;
  saveLS();render();closeModal();
}
function remove(){
  if(editIndex!==null){
    vocab.splice(editIndex,1);
    saveLS();render();closeModal();
  }
}

function playWord(e,text,rate){
  e.stopPropagation();
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  u.rate=rate;
  speechSynthesis.speak(u);
}
function speak(slow){
  const text=mWord.value;
  if(!text)return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  u.rate=slow?0.6:1;
  speechSynthesis.speak(u);
}

function exportCSV(){
  let csv="word,ipa,meaning,example\n";
  vocab.forEach(v=>{
    csv+=`${v.word},${v.ipa||""},${v.meaning},${(v.example||"").replace(/"/g,'""')}\n`;
  });
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="myvocab.csv";
  a.click();
}

function importCSV(e){
  const f=e.target.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>{
    const lines=r.result.split(/\r?\n/).filter(l=>l.trim());
    vocab=[];
    lines.forEach((l,i)=>{
      if(i===0)return;
      const c=l.split(",");
      if(c[0]&&c[2]){
        vocab.push({
          word:c[0].trim(),
          ipa:(c[1]||"").trim(),
          meaning:c[2].trim(),
          example:c.slice(3).join(",").trim()
        });
      }
    });
    saveLS();render();
  };
  r.readAsText(f);
}

render();
</script>

</body>
</html>
