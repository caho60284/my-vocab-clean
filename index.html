<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>My Vocab ‚Äì Doc Chan Edition</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}
body{margin:0;background:#f5f7fb}

/* HEADER */
header{
  position:sticky;top:0;background:#fff;padding:16px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);z-index:10
}
h1{margin:0 0 6px;font-size:22px}
.count{font-size:14px;color:#666}
.controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
button{
  border:none;padding:10px 14px;border-radius:10px;
  font-size:16px;cursor:pointer
}
.import{background:#1e88e5;color:#fff}
.export{background:#6a5acd;color:#fff}
.deleteall{background:#e53935;color:#fff}
.add{margin-left:auto;background:#e3f2fd;font-size:22px}

/* SEARCH (ANTI-ZOOM iOS) */
.search{width:100%;margin-top:12px}
.search input{
  width:100%;padding:12px;font-size:16px;
  border-radius:10px;border:1px solid #ccc
}

/* LIST */
main{padding:16px}
.card{
  background:#fff;border-radius:14px;padding:14px;margin-bottom:12px;
  display:flex;justify-content:space-between;align-items:center
}
.word{font-weight:700;font-size:18px}
.ipa{color:#555;font-style:italic;margin-top:2px}
.meaning{color:#333;margin-top:4px}
.icons span{font-size:20px;margin-left:10px;cursor:pointer}

/* MODAL */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.4);
  display:none;align-items:center;justify-content:center;z-index:99
}
.modal-content{
  background:#fff;width:90%;max-width:380px;
  padding:16px;border-radius:14px
}
.modal-content input,.modal-content textarea{
  width:100%;margin-bottom:8px;padding:12px;font-size:16px;
  border-radius:8px;border:1px solid #ccc
}

/* Example display (WRAP like WhatsApp) */
.example-view{
  background:#f7f9ff;border-radius:10px;padding:10px;margin-top:6px;
  white-space:pre-wrap; /* üîë wrap + new line */
  word-wrap:break-word;
  line-height:1.4;font-size:15px;color:#222
}

.modal-actions{display:flex;gap:8px;margin-top:10px}
.save{background:#1e88e5;color:#fff;flex:1}
.delete{background:#e53935;color:#fff;flex:1}
.cancel{background:#bbb;flex:1}
.audio{background:#2ecc71;color:#fff;flex:1}
</style>
</head>

<body>

<header>
  <h1>üìò My Vocab ‚Äì Doc Chan Edition</h1>
  <div class="count" id="count"></div>

  <div class="controls">
    <button class="import" onclick="importCSV()">üì• Import</button>
    <button class="export" onclick="exportCSV()">üì§ Export</button>
    <button class="deleteall" onclick="deleteAll()">üß® Delete All</button>
    <button class="add" onclick="openModal()">Ôºã</button>
  </div>

  <div class="search">
    <input id="search" placeholder="Search word or meaning..." oninput="render()">
  </div>
</header>

<main id="list"></main>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <input id="mWord" placeholder="Word">
    <input id="mPron" placeholder="Pronunciation (IPA)">
    <input id="mMeaning" placeholder="Meaning">
    <textarea id="mExample" placeholder="Example (max 2 lines, use ENTER)"></textarea>

    <!-- Preview example (wrapped) -->
    <div class="example-view" id="exampleView" style="display:none"></div>

    <div class="modal-actions">
      <button class="audio" onclick="playExample()">üîä</button>
      <button class="audio" onclick="playExampleSlow()">üê¢</button>
    </div>

    <div class="modal-actions">
      <button class="save" onclick="save()">Save</button>
      <button class="delete" onclick="remove()">Delete</button>
      <button class="cancel" onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("vocab") || "[]");
let editIndex = null;

/* RENDER */
function render(){
  const q = document.getElementById("search").value.toLowerCase();
  const list = document.getElementById("list");
  list.innerHTML = "";
  document.getElementById("count").innerText = `Total vocabulary: ${data.length} words`;

  data.forEach((v,i)=>{
    if(q && !v.word.toLowerCase().includes(q) && !(v.meaning||"").toLowerCase().includes(q)) return;
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <div>
        <div class="word">${v.word}</div>
        <div class="ipa">${v.pron||""}</div>
        <div class="meaning">${v.meaning||""}</div>
      </div>
      <div class="icons">
        <span onclick="playWord('${v.word}')">üîä</span>
        <span onclick="playWordSlow('${v.word}')">üê¢</span>
        <span onclick="edit(${i})">‚úèÔ∏è</span>
      </div>
    `;
    list.appendChild(d);
  });
  localStorage.setItem("vocab", JSON.stringify(data));
}

/* MODAL */
function openModal(){
  editIndex=null;
  mWord.value=mPron.value=mMeaning.value=mExample.value="";
  exampleView.style.display="none";
  modal.style.display="flex";
}
function closeModal(){ modal.style.display="none"; }

/* SAVE (MAX 2 EXAMPLES) */
function save(){
  if(!mWord.value.trim()) return;
  let ex = mExample.value.split(/\n+/).slice(0,2).join("\n"); // üîí max 2
  const v={word:mWord.value.trim(), pron:mPron.value.trim(), meaning:mMeaning.value.trim(), example:ex};
  if(editIndex===null) data.push(v);
  else data[editIndex]=v;
  closeModal(); render();
}

function edit(i){
  editIndex=i;
  const v=data[i];
  mWord.value=v.word; mPron.value=v.pron; mMeaning.value=v.meaning; mExample.value=v.example||"";
  showExamplePreview();
  modal.style.display="flex";
}

function remove(){
  if(editIndex!==null && confirm("Delete this word?")){
    data.splice(editIndex,1);
    closeModal(); render();
  }
}

function deleteAll(){
  if(confirm("DELETE ALL DATA?")){
    data=[]; localStorage.removeItem("vocab"); render();
  }
}

/* EXAMPLE PREVIEW (WRAPPED) */
mExample.addEventListener("input", showExamplePreview);
function showExamplePreview(){
  const txt = mExample.value.split(/\n+/).slice(0,2).join("\n");
  if(txt.trim()){
    exampleView.textContent = txt;
    exampleView.style.display="block";
  }else{
    exampleView.style.display="none";
  }
}

/* AUDIO */
function playWord(t){ speechSynthesis.speak(new SpeechSynthesisUtterance(t)); }
function playWordSlow(t){ let u=new SpeechSynthesisUtterance(t); u.rate=0.6; speechSynthesis.speak(u); }
function playExample(){
  if(exampleView.textContent) speechSynthesis.speak(new SpeechSynthesisUtterance(exampleView.textContent));
}
function playExampleSlow(){
  if(exampleView.textContent){ let u=new SpeechSynthesisUtterance(exampleView.textContent); u.rate=0.6; speechSynthesis.speak(u); }
}

/* CSV (ORDER FIXED) */
function exportCSV(){
  let csv="word,pronunciation,meaning,example\n";
  data.forEach(v=>{
    csv+=`"${v.word}","${v.pron}","${v.meaning}","${v.example||""}"\n`;
  });
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv;charset=utf-8;"}));
  a.download="my-vocab-backup.csv"; a.click();
}

function importCSV(){
  const i=document.createElement("input");
  i.type="file"; i.accept=".csv";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      const lines=r.result.split(/\r?\n/).filter(l=>l.trim());
      data=[];
      lines.forEach((l,idx)=>{
        if(idx===0) return;
        const c=l.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
        if(!c) return;
        data.push({
          word:c[0]?.replace(/"/g,"")||"",
          pron:c[1]?.replace(/"/g,"")||"",
          meaning:c[2]?.replace(/"/g,"")||"",
          example:(c[3]?.replace(/"/g,"")||"").split(/\n+/).slice(0,2).join("\n")
        });
      });
      render(); alert("Import sukses (DATA DIGANTI TOTAL)");
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

render();
</script>
</body>
</html>
